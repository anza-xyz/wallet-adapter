# Nextjs 14 wallet-adapter Starter

### Install

Install these dependencies:

```shell
npm install --save \
    @solana/wallet-adapter-base \
    @solana/wallet-adapter-react \
    @solana/wallet-adapter-react-ui \
    @solana/wallet-adapter-wallets \
    @solana/web3.js
```

### Setup

#### Wallet Context Provider

```JSX
"use client";
// use client is needed to specify it is client side component

import React from "react";
import {
  ConnectionProvider,
  WalletProvider,
} from "@solana/wallet-adapter-react";
import { WalletModalProvider } from "@solana/wallet-adapter-react-ui";
import { clusterApiUrl } from "@solana/web3.js";
import { WalletAdapterNetwork } from "@solana/wallet-adapter-base";

type WalletContextProviderProps = {
  children: React.ReactNode;
};
const WalletContextProvider = ({ children }: WalletContextProviderProps) => {
  const network = WalletAdapterNetwork.Devnet;
  const endpoint = clusterApiUrl(network);
  const wallets: any = [];

  return (
    <ConnectionProvider endpoint={endpoint}>
      <WalletProvider wallets={wallets} autoConnect>
        <WalletModalProvider>{children}</WalletModalProvider>
      </WalletProvider>
    </ConnectionProvider>
  );
};

export default WalletContextProvider;
```

#### layout.tsx
It provides the context to whole nextjs app.

```JSX
import WalletContextProvider from '@/components/WalletContextProvider'
import type { Metadata } from 'next'

export const metadata: Metadata = {
  title: 'Solana Wallet Connector Nextjs 14 Starter example',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    //wallet context provider
    <WalletContextProvider>
        <html lang="en">
            <body>{children}</body>
        </html>
    </WalletContextProvider>
  )
}
```

#### Usage

```JSX
"use client";

require("@solana/wallet-adapter-react-ui/styles.css");

import styles from "./walletconnect.module.css";
import dynamic from "next/dynamic";
import { useEffect, useState } from "react";
import { useWallet } from "@solana/wallet-adapter-react";

/*
  The use of `next/dynamic` is necessary here because components from the
  @solana/wallet-adapter-react-ui library likely contain browser-specific code
  that is not executed during server-side rendering in Next.js. If these components
  undergo changes in their rendered output after being mounted on the client due
  to browser-specific code, it could result in errors.

  By employing `next/dynamic`, the WalletMultiButton component is deferred in its
  import and rendering until the client side. This strategy mitigates the
  server/client HTML mismatch issue that could arise from executing
  browser-specific code on the server. However, it's important to note
  that this approach may introduce a slight delay in rendering the
  WalletMultiButton component, as it only begins loading once the
  JavaScript for the page starts executing on the client.
*/

const WalletMultiButton = dynamic(
  () =>
    import("@solana/wallet-adapter-react-ui").then(
      (mod) => mod.WalletMultiButton
    ),
  { ssr: false, loading: () => <p>wallet button loading...</p> }
);

const WalletDisconnectButton = dynamic(
  () =>
    import("@solana/wallet-adapter-react-ui").then(
      (mod) => mod.WalletDisconnectButton
    ),
  { ssr: false, loading: () => <p>wallet button loading...</p> }
);

export const WalletConnect = () => {
  const { publicKey, connect, disconnect } = useWallet();

  useEffect(() => {
    // @ts-ignore
    const provider = window.solana;

    if (provider) {
      const handleAccountChange = async (newPublicKey: any) => {
        console.log("provider -> ", provider);
        try {
          // Disconnect the current wallet session
          await disconnect();

          // Reconnect to the new account
          if (newPublicKey) {
            console.log(`Switched to account ${newPublicKey.toBase58()}`);

            // await connect();
            // console.log(`Switch successful`);
          }
        } catch (err) {
          console.error("Failed to connect to the new account:", err);
        }
      };

      provider.on("accountChanged", handleAccountChange);

      // Clean up the event listener when the component unmounts
      return () => {
        provider.removeListener("accountChanged", handleAccountChange);
      };
    }
  }, [disconnect, connect]);
  console.log(styles.walletConnectContainer);

  return (
    <div className={styles.container}>
      <div className={styles.button}>
        <WalletMultiButton />
      </div>
      <div className={styles.button}>
        <WalletDisconnectButton />
      </div>
    </div>
  );
};

```
